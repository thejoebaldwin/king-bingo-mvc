@{
    ViewBag.Title = "Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var user = ViewBag.User;
}

<h2>Profile</h2>

  @Html.Raw("<img width=\"100px\" src=\"data:image/jpeg;base64," + Convert.ToBase64String( user.ProfileImage) + "\" />")


<script>

    function getFile() {
        document.getElementById("btnFile").click();
    }

</script>





    <!-- Button trigger modal -->
<button class="btn btn-success btn-lg" data-toggle="modal" data-target="#UploadModal" ">
  Change Picture
</button>

<!-- Modal -->
<div class="modal fade" id="UploadModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
    
        <div class="modal-header">
             <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
             <h4 class="modal-title" id="myModalLabel">Change your picture</h4>
        </div>
          <div class="modal-body">
          <form action="/secure/UploadImages" method="post" enctype="multipart/form-data">

              <div class="alert alert-danger"  id="errorMessage" style="display:none">
  <a href="#" class="alert-link" id="errorMessageText">...</a>
    </div>

           <input type="button"  class="btn btn-success btn-lg" value="Choose File" onclick="uploadClick()" />

              <button type="button" class="btn btn-lg" data-dismiss="modal">Close</button>

                        <input id="fileUpload" style="display:none"  type="file" name="file"  title="file upload" />
                
                 <input type="hidden" name="user_id" value="@user.UserId" />
                <input type="hidden" id="x0" name="x0" />
                <input type="hidden" id="y0" name="y0" />
                <input type="hidden" id="x1" name="x1" />
                <input type="hidden" id="y1" name="y1"  />

  <input class="btn btn-success btn-lg" id="btnSubmit" type="submit" value="OK" style="display:none"   />
</form>


      </div>
      <div class="modal-footer">

      
      </div>
         

    </div>
      @section scripts {
      <script>
          $("#fileUpload").change(function () {

           
              var fileUpload = document.getElementById("fileUpload");
              var file = fileUpload.files[0];
              var reader = new FileReader();

              var image = new Image();

              var n = file.name;
              var t = file.type.split('/')[1];
              var s = ~~(file.size / 1024);

              if (t == 'png' || t == 'jpg' || t == 'jpeg') {

                  reader.readAsDataURL(file);
                  reader.onload = function (_file) {

                      image.src = _file.target.result;
                      image.onload = function () {
                          var w = this.width,
                              h = this.height;

                          $("#errorMessage").show();
                          $('#errorMessageText').html('<img  id="jcrop_target" src="' + this.src + '"> ' + w + 'x' + h + ' ' + s + ' kb' + t + ' ' + n + '<br>');
                          $(function () {
                              $('#jcrop_target').Jcrop({
                                  aspectRatio: 1,
                                  minSize: [100, 100],
                                  setSelect: [20, 20, 120, 120],
                                  onChange: showCoords
                              });
                          });

                          $("#btnSubmit").show();
                      };
                  };


              }
              else {

              }

          

              //if (file.size > 100) {
                  
                //  $("#errorMessage").show();
                  //$("#errorMessageText").html('Filesize must 2.5mb or below');
               
              //}
              //else {
                  //document.getElementById("btnSubmit").click();
              //}
          });


          function showCoords(c) {
              // variables can be accessed here as
              // c.x, c.y, c.x2, c.y2, c.w, c.h
              $('#x0').val(c.x);
              $('#y0').val(c.y);
              $('#x1').val(c.x2);
              $('#y1').val(c.y2);
              
          };

          function uploadClick() {

              document.getElementById('fileUpload').click();

          }
      </script>
          }

  </div>

      
 
</div>




<form action="/secure/profile/create" method="post">
    Name:<input name="Name" id="Name" type="text" /><br />
    Email:<input name="Email" id="Email" type="text" /><br />
    Bio:<input name="Bio" id="Bio" type="text" /><br />
    Zip:<input name="Zip" id="Zip" type="text" /><br />
   


    <input type="submit" value="save" />
</form>

